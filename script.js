// Advent calendar content for each day
const adventContent = {
    1: {
        title: "The First Trick I Ever Loved",
        content: "<p>I tell this story at the beginning of my close up card show \"Tricks I Stole\".</p><p>I started magic when I was 6 years old. My dad would take me to \"Toymaster\", a popular UK toy shop. I bought those individual boxed magic tricks: Silk through glass, thumb tip, all those things. I would go home and practice for the day, then perform to my dad. I never fooled him. I think found a few books in my local \"Borders\" (for those who remember that book shop in the UK.) I would take them home, practice for a few weeks this time, and try to fool my dad. I never fooled him.</p><p>Then I found my local brick and mortar magic shop, \"Mike Danata's Magic Studio\", in Boscombe UK. It was small, but special. I would go after school and just stand in awe for hours. Mike would show me everything I wanted, and I'd always walk out with a bag of goodies. I'd go home, practice for months this time, just to try and fool my dad. And I did. I started to fool him and it felt amazing (my dad is annoyingly good at reverse engineering magic).</p><p>But then, Mike Danata closed his shop. I went on the hunt for more magicians in my area. I'd been completely alone in magic for 20 years at this point. I didn't know any other magicians. I had never ever met another magician. I had never been to a convention, never jammed. I gigged every now and again, but had no inclusion into the magic world at all. I had no idea it even existed. I knew of and posted on the Magic CafÃ© sometimes, until it became the unintelligible, backwards, and completely unusable forum it has been for years now.</p><p>A friend of mine told me to just message the person who I'd love to jam with the most and see what they say. What would they do? Say no? Oh well.</p><p>So I did, and they didn't. Before I knew it, I was on a train to London to have a pint with one of my idols. We chatted for ages, and then he got a pack of Red Bicycle cards out of his pocket. He simply askedâ€¦ what colour are the cards in this box? We have red bikes, and blue bikes, and this is a red box. So, you'd imagine there are red cards in there. But just the fact I'm asking, maybe it's obvious there are blue cards in there. Else, why would I ask? Ultimatelyâ€¦ it's up to you what colour the cards are. If you want them to be blue, they will be blue. If you want them to be red, they will be red. So, what do you want them to be?</p><p>I answered blue. I don't know why.</p><p>He opened the red box, and took blue bikes out of it. Ta-da.</p><p>It was the first time I had seen an original trick in-front of me. Up until this point it had been marketed tricks that I was seeing demos for. But this wasn't released. This was justâ€¦ in his personal repertoire.</p><p>I fell in love with a different side of the art, and this guy took me under his wing.</p><p>I was immediately thrown into the magic world, working with some of the best magicians on the planet. Seeing things I could have only dreamt of. I saw the good, I saw the bad, it was intense. And it all started from that one trick I fell in love with that day.</p>"
    },
    2: {
        title: "24/7 (Staying In It)",
        content: "<p>The artist's job is never truly finished.</p><p>In many occupations, when we go home, we leave our work behind at the office. The artist is always on call. Even after we get up from hours engaged in our craft, the clock is still running.</p><p>This is because the artist's job is of two kinds:</p><p>The work of doing.</p><p>The work of being.</p><p>Creativity is something you are, not only something you do. It's a way of moving through the world, every minute, every day. If you're not driven to an unrealistic standard of dedication, it may not be the path for you. So much of the artist's work is about balance, so it's ironic that this way of life leaves little room for it.</p><p>Once you acquiesce to the demands of the creative life, it becomes a part of you. Even in the midst of a project, you still look for new ideas each day. At any moment, you're prepared to stop what you're doing to make a note or a drawing, or capture a fleeting thought. It becomes second nature. And we're always in it, every hour of the day.</p><p>Staying in it means a commitment to remain open to what's around you. Paying attention and listening. Looking for connections and relationships in the outside world. Searching for beauty. Seeking stories. Noticing what you find interesting, what makes you lean forward. And knowing all of this is available to use next time you sit down to work, where the raw data gets put into form.</p><p>There is no telling where that next great story, painting, recipe, or business idea is going to come from. Just as a surfer can't control the waves, artists are at the mercy of the creative rhythms of nature. This is why it's of such great importance to remain aware and present at all times. Watching and waiting.</p><blockquote>\"Maybe the best idea is the one you're going to come up with this evening.\"</blockquote><p><em>Excerpt from Rick Ruben's \"The Creative Act\".</em></p>"
    },
    3: {
        title: "Christmas Treat!",
        content: "<p>The incredible Ollie Mealing has very generously offered us a BANGER of an offer for Christmas.</p><p>You can get access to a crazy amount of magic for just Â£1.</p><p>Thats right... Â£1.</p><p>If you don't know Ollie, he took the card magic world by storm a while back and started one of the very first ever magic memberships 'Mealings Membership'. It skyrocketed and now his multiple series that he does for magic are truly fascinating to watch.</p><p>You can see plenty of his performances on YouTube, just search \"Ollie Mealing\" (We did a project called Fiver Friday where Ollie fooled me every week for a year and you got to learn everything!)</p><p>And now, he is offering a whole month of his entire membership for just Â£1. That's right... Â£1!</p><p>Not only that, but once the month ends, you can stay on for 50% off the usual cost! It's usually Â£20 a month, but he'll keep you on for just Â£10. That means by the end of January, you could be loaded with fresh new effects, new methods, and new ideas... for less than a couple of pints in London.</p><p>Offer ends midnight GMT, 7th December, so don't miss out!</p><p>Use the link below, or use the code THEMAG1 at checkout to claim your offer!</p><p><a href=\"https://mealing.co/themag\" target=\"_blank\" rel=\"noopener\">mealing.co/themag</a></p>"
    },
    4: {
        title: "I Don't Like Mnemonica",
        content: "<p>I've always loved the idea of a stacked deck. The idea that I can have a deck and know it back to front and inside out, opens up a world of possibility when it comes to card magic. So I did a bit of digging to find the stack that works for me. I tried Mnemonicaâ€¦ I meanâ€¦ it's the most popular stack in the world, there must be something to it. But I wasn't satisfied with a) the price, and b) the effects.</p><p>I don't know why, it just didn't excite me.</p><p>I went searching for more and came across some real contenders, until I found one. The Redford Stack.</p><p>Why? Because it was taught exceptionally, the effects made sense, they were my style, and the memorisation of the stack was easy as pie.</p><p>For those that don't know, Patrick Redford is an incredible magician and mentalist in Detroit and has a series of books called \"â€¦ Out Of Order\". His first book in the series, \"Temporarily Out Of Order\" is the book that started this whole thing for me.</p><p>Now look, I am LAZY. I do not want to sit and memorise a stack, so I need to be easy and spoon fed, and practical. The book taught the stack in a way that I had down in just a few days. More so, one of the best routines in the book (a multi-phase routine where the cards are shuffled, then match in increasingly impossible ways, ending with the spectator themselves shuffling into New Deck Order), didn't even require you to memorise the stack. But HOW was I supposed to get into stack without memorising it? Well, he also offers a few effects to get from a shuffled deck into Si Stebbins, and then into Redford. This means, I can take ANY DECK (as long as it's complete), do a poker routine, do a clocking routine, and then go into this multi-phase routine ending in New Deck Order. It's essentially a 45 minute show with a borrowed deck that requires zero memory, despite being based entirely around a stacked deck.</p><p>And that's just a few effects in one book. He also has \"Sleightly Out Of Order\" and \"Completely Out Of Order\", which expand on the idea and bring in other creators' effects to heighten the Redford stack.</p><p>In my close up show \"Tricks I Stole\", I miss the get-ready effects and switch directly into Redford stack, with the WHOLE second act being that multi-phase routine. It's very powerful. In future, when I do the show, I may do a deck switch routine he teaches called \"The Interchange Force\" to get into \"Temporarily Out Of Order\", removing the need for my current deck switching routine (that I'll be tipping on 17th).</p><p>If you want to support Patrick, and learn an incredible versatile and well researched stack, you can do so in multiple places (if you can find it in stock!)</p>"
    },
    5: {
        title: "The Energy (In the Work)",
        content: "<p>What motivates us to work so diligently? What drives us to finish certain pieces and not others?</p><p>We would like to think that it's our enthusiasm. A feeling that wells up when in the throes of self-expression.</p><p>This energy is not generated by us. We are caught by it. We picked it up from the work. It contains the charge. A contagious vitality that pulls us forward.</p><p>Works hinting at greatness contain a charge we can feel, like static before a lightning storm. They consume their maker, occupying waking thoughts and dreams. Sometimes they become the artist's reason for living.</p><p>The energy feels similar to another force of creation in the world:</p><p>Love.</p><p>A kinetic draw beyond our rational comprehension.</p><p>Early in a project, excitement is the inner voltmeter to watch to help choose which seed to develop. When you're handling a seed and the needle jumps, it indicates that the work is worthy of your attention, your devotion. It holds the potential to sustain your interest and make the effort worthwhile.</p><p>As you experiment and craft, more energetic charges are set off as further decisions are made. You catch yourself losing track of time, forgetting to eat, withdrawing from the outside world.</p><p>Other times the process is a grind. Minutes pass slowly and you count down the days until the work is complete. A prisoner etching marks on a cell wall.</p><p>Remember that the energy in the work isn't always accessible to you. At times, you take a wrong turn and the charge is lost. Or you're so deep in the details that you can't see the bigger picture. Even with the greatest work, it's natural for excitement to wax and wane.</p><p>If the work is thrilling one day and isn't for a long while after, you may have experienced a false indicator. When the moments of joy seem like a distant memory and the work feels like an obligation to a past idea, this could mean you've either gone too far or that particular seed wasn't actually ready to germinate yet.</p><p>If the energy is depleted, either back up a few steps to tap back into the charge or find a new seed generating excitement. One of the skills an artist develops is the ability to recognize when either they or the work have nothing left to give each other.</p><p>All living things are interconnected, depending on one another to survive. A work of art is no different. It generates excitement in you. This commands your attention. And your attention is exactly what's required for it to grow. It's a harmonic, mutually dependent relationship. The creator and the creation rely on each other to thrive.</p><p><em>Excerpt from Rick Ruben's \"The Creative Act\".</em></p>"
    },
    6: {
        title: "What we could learn from PokÃ©mon Cards",
        content: "<p>Hear me out.</p><p>One evening I was scrolling through social media when I stumbled across a short clip of a man trading PokÃ©mon cards at a convention. In the video, he gave away a $100 card to a kidâ€¦ for free. Why? The kid was kind, wanted the card, and didn't have the money. The trader felt generous.</p><p>The smaller why doesn't really matter. The bigger why does.</p><p>Off the back of that video, he built a community. People tune into his live streams, donate money so kids can get the cards they dream of, and even send him cards to give away. It's generosity turned into culture. A community built not on profit, but on kindness.</p><p>Because of that support, he can make a living while giving things away. He can cut deals for families going through rough times, hand out packs to kids, and still keep his lights on.</p><p>Why?</p><p>To keep the love alive.</p><p>You probably remember what it felt like to be a kid obsessed with a hobby. Collecting cards, learning a trick, building something. Over time, that spark fades as we realise the capitalism behind it all. Prices rise faster than inflation, companies chase margins, and passion turns into product. But these people, like Coops Collection and Beard Dad Cardz, are fighting that. They just want to make someone's day. They know how silly PokÃ©mon cards are, and they lean into it, using that silliness to bring light and joy to a community that's been dulled by greed.</p><p>And it made me think of us.</p><p>Of the magic community.</p><p>What are we doing to bring more kids into the art? What are we doing to keep the love alive, to inspire and motivate?</p><p>Sure, there are exceptions. Vanishing Inc. run young magicians' scholarships. Alon Magic Society and Daily Magician offer incredible value for tiny costs, often not even enough to cover server fees. Their projects exist for one reason: to share the love of magic.</p><p>But beyond that, how often do we see real generosity in this industry? When was the last time someone said, \"You know what, I'll just give this trick to someone who needs it\"? There are drawers and boxes across the world full of effects that will never see daylight again. What if those props, sitting unused, could spark a lifelong passion in a young magician? All it takes is a bit of kindness.</p><p>I've spoken to creators who admit they base their pricing on others. \"This person released something for $350, so I can charge Â£400.\" Or, \"This took me six months to build, so I'll price it at $1000 to make my money back.\"</p><p>I understand that logic. Everyone wants their hard work to be valued. But when we start to measure worth only in money, we forget about the audience we're supposed to be inspiring. Somewhere along the line, it became more appealing to sell ten products for $1000 each than a thousand for $10 each.</p><p>And that's the culture we need to change.</p><p>Instead, we've created an industry that seems proud to lock people out. $300 apps. $1200 gimmicks. Products priced so high they're treated like secret relics, \"for professionals only.\" As if excluding hobbyists were a mark of prestige.</p><p>It isn't. It's a tragedy.</p><p>Magic shouldn't be a gated community. It's a shared language of wonder.</p><p>When I created this magazine, I made a promise to myself: to keep it affordable. I calculated the printing costs, shipping costs, and contributor pay, and priced it as fairly as possible. When I found a printer that offered free shipping, I passed that saving directly to you, because if I can make it cheaper, I will. If we ever grow enough to reduce costs further, that money will go straight back into lowering your price and paying contributors more.</p><p>That's how it should be.</p><p>That's community.</p><p>I'm incredibly lucky to do magic full time. If that ever becomes just this full time; this magazine, this project, this shared love; then every extra penny will go where it should: back into the art and the people who make it.</p><p>All because I saw a guy give a shiny Pikachu to a six-year-old and make them smile.</p>"
    },
    7: {
        title: "How to Force a Card",
        content: "<p>If you don't know who Ollie Mealing is, you're about to. I worked with Ollie during the production of his series Fiver Friday, and every now and again he would just... do this.</p><div class=\"modal-video\"><iframe src=\"https://www.youtube.com/embed/eKHY_H3IItc\" title=\"Day 7 reveal\" frameborder=\"0\" allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture\" allowfullscreen></iframe></div>"
    },
    8: {
        title: "EDC Doesn't Exist",
        content: "<p>I don't think I understand what EDC is. For those that don't know, EDC stands for \"Every Day Carry\". It's used to describe the magic you have on you at any point in the day whilst you're out and about. Basically, what do you do when somebody catches you off guard and asks you to do something.</p><p>But the more I see people's \"EDC\", the more I realise that EDC doesn't really exist.</p><p>Let's take it literally: EVERY DAY CARRY.</p><p>Every day.</p><p>Not some days.</p><p>Not \"I'm going to the pub with my friends\" days.</p><p>Every. Single. Day.</p><p>Have you got a long 13 hour shift at work you need to crack on with? What are you taking with you?</p><p>Do you need to run out for a pint of milk from the local 24 hour petrol station at 1am? What are you taking with you?</p><p>If you're sat there thinking \"Yes, Andy, if I were to go out at 1am to grab some milk in my pyjamas and slippers at 1am, then I am 100% taking my Tarot packet trick and my electronic dice and receivers.\", then I call BS.</p><p>If we're being relaxed on the meaning, then sureâ€¦ my entire magic set is an EDC. I rarely leave the house without at least my phone and a deck of cards/business cards in my pocket. I wouldn't say it's an EDC. Even now as I'm sat in a, quite frankly, too posh cafÃ© for the likes of myself, I sit with a deck of Copag 310's in my pocket, and my phone. No business cards, no pens, no dupes, no packet tricks, no electronics (other than the phone). Would I consider a deck of cards my EDC? Nah, not really. I probably leave the house with them 9/10. But 9 days out of 10 isn't every day.</p><p>So, stop saying that your linking rings is in your EDC. It isn't.</p><p>Of course, if I am out specifically in a situation where I feel magic may come up in conversation, or if there is the slightest possibility I want to perform something, then I can take anything I want. I can whack my Sonore, or my Rex Ignis, or my entire close up/parlour show set up in my pocket or bag. But my real EDC is barely my phone at this point.</p><p>Thanks for coming to my TED Talk.</p>"
    },
    9: {
        title: "Our Plans for Blackpool â€“ Interested?",
        content: "<p>Being a purely physical product, we don't get to see each other much. We want to change that by maximising the only opportunity magicians get the chance to all hang out together. Blackpool is undoubtedly a huge convention, and is majorly overwhelming sometimes. However, it's such a great opportunity to hang out with people you may not get the chance to see for the rest of the year. We want to use the conventions to meet you guys, and build the community further. But we want your input, what do you want?</p><p>Here is my thought: Saturday morning, a meet up in Blackpool. We can talk all things Mag, go through handlings you may be confused about, plus I could bring the physical copy for February to give you in person! (Should I offer a pick-up in person option for Feb?).</p><p>We also want to try and use the conventions as a way to build our subscriber base. In a few days, you'll read why I think we could learn from other industries, and part of that is what happens when we hit a certain amount of members in the community.</p><p>This isn't to line my pockets (this may as well be a non-profit endeavour), it's to spread the love of magic, and create something special. To be in the position to be able to offer you some amazing things at no extra cost, we need more members. Conventions are our chance to do that.</p><p>So let's shake it up.</p><p>I'm planning of having the team wear some Mag merch so we are recognisable (Mag bag, Mag hoody etc). Inside the bag are FREE taster copies (like a booklet, not a newspaper), that have some tricks, articles, and interviews in. Completely FREE.</p><p>Not only that, but maybe some keyrings, or magnetsâ€¦ or is that too clichÃ©? Maybe a competition. Find the September newspaper and win a free YEAR of subscription, find October to win 9 months free, November to win 6 months free, December to win 3 months free, and January to win 1 month free? Hidden around the Winter Gardens and local area? Too much? What would you enjoy?</p><p>If you have any ways for us to shake up the community during Blackpool, please feel free to pitch them below. I can't wait to read them and try to build the community further!</p>"
    },
    10: {
        title: "Shades and Degrees",
        content: "<p>In the creation of art, proportions can be deceptive.</p><p>Two seeds of inspiration might seem indistinguishable, but one may yield volumes and the other little to nothing. What begins as a lightning bolt may not produce a work that reflects its initial magnitude, whereas a humble spark may grow into an epic masterpiece.</p><p>In crafting, the amount of time we put in and the results we get are rarely in balance. A large movement may materialize all at once; other times a tiny detail may take days. And there's no predicting how much of a role either will play in the final outcome.</p><p>Another surprising facet of the process is how the tiniest of details can clearly define a work. They can determine whether a piece is stimulating or languid, finished or unfinished. We make one dab of the brush, one tweak in the mixâ€”and suddenly the work jumps from being halfway done to complete. When it happens, this seems miraculous.</p><p>What ultimately makes a work great is the sum total of the tiniest details. From start to finish, everything has shades and degrees. There is no fixed scale. There can't be, because sometimes the smallest elements are the ones that weigh the most.</p><p><em>Excerpt from Rick Ruben's \"The Creative Act\".</em></p>"
    },
    11: {
        title: "Card Through Box",
        content: "<p>I went through a phase of trying to be all social media-y and posting videos of myself doing card stuff to music. I love all the videos, and you'll see a few in the next couple of weeks, but this is one of my favourites. Absolutely no idea where I saw this idea, but it's fun. Enjoy!</p><div class=\"modal-video\"><iframe src=\"https://www.youtube.com/embed/-6rXPMujTG4\" title=\"Day 11 reveal\" frameborder=\"0\" allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture\" allowfullscreen></iframe></div>"
    },
    12: {
        title: "The Power Of Pseudo-Signatures",
        content: "<p>One of my favourites routines I've ever performed is a Two Card Transposition I call \"Two\". Here is the effect:</p><p>One person signs one card and holds it between their hands.</p><p>Another person on the other side of the room signs another card, and holds it between their hands.</p><p>You never go back to person 1. They open their hands and there is Person 2's signed card. Person 2 then open's their hand and there's Person 1's card. The cards are returned to the owners and can be kept as souvenirs.</p><p>Usually, the magician would have to go back to the first person to switch in Person 2's card, but in this, they don't. And it relies on a pseudo-signature.</p><p>Grab a dupe of a court card, and scribble a random signature into the border. I have probably thought too much about the best way to do this, and will talk about my signature research (is this a thing?) in a future edition. Place this dupe on top of the deck face down, then place a random number card, then the unsigned court card.</p><p>Pick two people that don't know each other. This is vital.</p><p>Double lift and have Person 1 sign the normal number card â€“ let's say the 4 of diamonds.</p><p>Turn the double face down, and give Person 1 the top face down card (the dupe with pseudo-signature on). Then go to Person 2.</p><p>Double lift again, and have them sign in the border (mention it must be in the border).</p><p>Once done, turn the double over and give them the top face down card (4 of diamonds, signed).</p><p>Now wait.</p><p>Do the magic thing.</p><p>Then have Person 1 open their hands. At this point, they know the card and they know it's signed. They have never seen Person 2's signature. So they react like that MUST be it. As they are reacting and showing the audience, distract Person 2 by getting them to also open their hand and turn over the card.</p><p>I immediately pick up the 4D and show it to Person 1 from across the room. Walking towards them as I do. Attention is now on the card with the real signature on it. I reach Person 1 and give them back their card, taking Person 2's from them. I do a broken top change whilst confirming Person 1 has their card back, and immediately show Person 2 their real card, walking towards them. I give Person 2 their card and they go on their way to a round of applause.</p><p>Seems simple, but absolutely FRIES audiences. Obviously because the two spectators do not know each other, they would not recognise signatures of each other, and probably won't chat after (even though it's fine if they do - Human's aren't built to memorise the strokes of a random signature they saw an hour previously)</p><p>I use this routine to justify switching a deck in my close up show. I take two people who didn't arrive together and use them. As I'm getting up from my chair and moving one person to one side of the room and the other to the further side of the room, it creates a \"breath\" in the room. People relax for a second, they pick up their drink, they say that comment to their friend. As far as they care, we're in a quick 30 second interval. It allows my plenty of time to dip my hand into my pocket and switch the deck (with the dupes ready and in position on top).</p><p>As mentioned in Day 3, I may swap this for the Interchange Force from Patrick Redford, so I don't need to leave the table. At the moment, having to fake sign a duplicate every show means I'm rinsing through decks like there is no tomorrow.</p>"
    },
    13: {
        title: "Dice ACAAN",
        content: "<p>I found this video that I took on my bedroom floor 10 years ago. I watched it, tongue in cheek, thinking I'll look back on those days and wonder how I've come so far. As I sat back, expecting to watch little Andy fumble and stumble and be generally awful, I buckled in for a ride. Anyway, I fooled myself for a bit. Enjoy!</p><div class=\"modal-video\"><iframe src=\"https://www.youtube.com/embed/ey8k_HEyzOU\" title=\"Day 13 reveal\" frameborder=\"0\" allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture\" allowfullscreen></iframe></div>"
    },
    14: {
        title: "Day 14: The Enchanted Hour",
        content: "<p>There are moments when time stands still, when the impossible becomes possible, when magic happens.</p><blockquote>'Time is a created thing. To say \"I don't have time\" is to say \"I don't want to.\"'</blockquote>"
    },
    15: {
        title: "Day 15: The Gathering",
        content: "<p>As we approach the heart of December, energies converge. Something wonderful is building.</p><blockquote>'Alone we can do so little; together we can do so much.'</blockquote>"
    },
    16: {
        title: "Day 16: Ancient Echoes",
        content: "<p>The whispers of the past carry forward, their messages timeless and true.</p><blockquote>'Those who cannot remember the past are condemned to repeat it.'</blockquote>"
    },
    17: {
        title: "Day 17: The Great Awakening",
        content: "<p>With each passing day, you awaken more fully to your own potential. The transformation has begun.</p><blockquote>'You have been assigned this mountain to show others it can be moved.'</blockquote>"
    },
    18: {
        title: "Day 18: The Final Stretch",
        content: "<p>We near the culmination of our journey. The mysteries deepen, the magic intensifies.</p><blockquote>'The journey of a thousand miles begins with one step.'</blockquote>"
    },
    19: {
        title: "Day 19: Convergence",
        content: "<p>All paths begin to converge. What seemed separate is revealed as one great tapestry.</p><blockquote>'Everything is connected. No one thing can change by itself.'</blockquote>"
    },
    20: {
        title: "Day 20: The Revelation",
        content: "<p>Great truths reveal themselves to those who are ready to receive them. Are you ready?</p><blockquote>'The truth will set you free, but first it will piss you off.'</blockquote>"
    },
    21: {
        title: "Day 21: The Solstice",
        content: "<p>On the longest night, the deepest magic stirs. From darkness comes light, from winter comes spring.</p><blockquote>'In the depth of winter, I finally learned that within me there lay an invincible summer.'</blockquote>"
    },
    22: {
        title: "Day 22: Almost There",
        content: "<p>The final mysteries are near. Hold fast, for the greatest revelations are yet to come.</p><blockquote>'It is during our darkest moments that we must focus to see the light.'</blockquote>"
    },
    23: {
        title: "Day 23: The Eve of Eves",
        content: "<p>Anticipation fills the air. Tomorrow holds something special, something magical, something transformative.</p><blockquote>'Hope is being able to see that there is light despite all of the darkness.'</blockquote>"
    },
    24: {
        title: "Dec 24: The Old Episode",
        type: "youtube",
        videoId: "qffoCxD_BvY"
    },
    25: {
        title: "Christmas Day: The Greatest Gift",
        content: "<p>ðŸŽ„ Merry Christmas! ðŸŽ„</p><p>On this special day, may the magic you've discovered throughout December fill your heart and home with joy, love, and wonder.</p><blockquote>'The best gift is a portion of thyself.'</blockquote><p>Thank you for joining The Magician's Desk this December. May your Christmas be magical in every way.</p><p>âœ¨ With love and magic âœ¨</p>"
    }
};

const TOTAL_DAYS = 25;
const OPENED_STORAGE_KEY = 'magiciansDeskOpened_v4';
const FORCE_UNLOCK_DAYS = new Set();

const countdownContainer = document.getElementById('countdownContainer');
const countdownText = document.getElementById('countdownText');
const countdownClock = document.getElementById('countdownClock');
const countdownProgress = document.getElementById('countdownProgress');
const footerMessage = document.getElementById('footerMessage');

function formatTimeFromMilliseconds(ms) {
    const clamped = Math.max(0, ms);
    const totalSeconds = Math.floor(clamped / 1000);
    const hours = Math.floor(totalSeconds / 3600);
    const minutes = Math.floor((totalSeconds % 3600) / 60);
    const seconds = totalSeconds % 60;
    return `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
}

// Initialise calendar on DOM ready
document.addEventListener('DOMContentLoaded', () => {
    initializeCalendar();
    refreshCardLockStates();
    initializeModal();
    initializeCountdown();
});

// Helpers
function getOpenedCards() {
    const opened = localStorage.getItem(OPENED_STORAGE_KEY);
    return opened ? JSON.parse(opened) : [];
}

function saveOpenedCard(day) {
    const opened = new Set(getOpenedCards());
    opened.add(day);
    localStorage.setItem(OPENED_STORAGE_KEY, JSON.stringify([...opened]));
}

function hasOpenedDay(day) {
    return getOpenedCards().includes(day);
}

function isDateUnlocked(day) {
    if (FORCE_UNLOCK_DAYS.has(day)) {
        return true;
    }
    const now = new Date();
    const year = now.getUTCFullYear();
    const currentMonth = now.getUTCMonth();
    const unlockTime = Date.UTC(year, 11, day, 0, 0, 0); // December (11) at 00:00 GMT

    if (currentMonth < 11) {
        return false;
    }

    if (currentMonth > 11) {
        return true;
    }

    return now.getTime() >= unlockTime;
}

function getNextUnlockDay() {
    const now = new Date();
    const year = now.getUTCFullYear();

    for (let day = 1; day <= TOTAL_DAYS; day++) {
        if (FORCE_UNLOCK_DAYS.has(day)) {
            continue;
        }
        const unlockTime = Date.UTC(year, 11, day, 0, 0, 0);
        if (now.getTime() < unlockTime) {
            return { day, unlockTime };
        }
    }
    return null;
}

function initializeCountdown() {
    updateCountdown();
    setInterval(updateCountdown, 1000);
}

function updateCountdown() {
    refreshCardLockStates();

    const openedCards = getOpenedCards();

    if (openedCards.includes(25)) {
        countdownContainer.style.display = 'none';
        footerMessage.textContent = 'Merry Christmas, from the Mag!';
        return;
    }

    countdownContainer.style.display = 'flex';

    const now = new Date();
    const nextUnlock = getNextUnlockDay();

    if (!nextUnlock) {
        countdownText.textContent = 'Next door unlocks in';
        countdownClock.textContent = '00:00:00';
        countdownProgress.style.width = '100%';
        return;
    }

    const { day, unlockTime } = nextUnlock;
    const timeRemaining = unlockTime - now.getTime();

    countdownText.textContent = 'Next door unlocks in';

    if (timeRemaining <= 0) {
        countdownClock.textContent = '00:00:00';
        countdownProgress.style.width = '100%';
        return;
    }

    const year = now.getUTCFullYear();
    const previousUnlockTime = Date.UTC(year, 11, day - 1, 0, 0, 0);
    const interval = Math.max(1, unlockTime - previousUnlockTime);
    const progress = Math.max(0, Math.min(1, 1 - timeRemaining / interval));
    countdownProgress.style.width = `${progress * 100}%`;

    countdownClock.textContent = formatTimeFromMilliseconds(timeRemaining);
}

function refreshCardLockStates() {
    const cards = document.querySelectorAll('.card');
    cards.forEach(card => {
        const day = Number(card.dataset.day);
        const unlocked = isDateUnlocked(day);

        if (unlocked) {
            card.classList.remove('locked');
        } else {
            card.classList.add('locked');
        }
    });
}

// Card creation
function initializeCalendar() {
    const grid = document.getElementById('cardsGrid');
    const days = shuffleArray(Array.from({ length: TOTAL_DAYS }, (_, i) => i + 1));

    days.forEach(day => {
        const card = createCard(day);
        grid.appendChild(card);
    });
}

function shuffleArray(array) {
    const arr = [...array];
    for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
    }
    return arr;
}

function createCard(day) {
    const card = document.createElement('div');
    card.className = 'card';
    card.dataset.day = day;

    const unlocked = isDateUnlocked(day);
    const opened = hasOpenedDay(day);

    if (!unlocked) {
        card.classList.add('locked');
    } else {
        card.classList.remove('locked');
    }

    card.innerHTML = `
        <div class="card-inner">
            <div class="card-front">
                <div class="card-number">${day}</div>
            </div>
            <div class="card-back">
            </div>
        </div>
    `;

    if (opened) {
        card.classList.add('flipped');
    }

    card.addEventListener('click', () => {
        if (card.classList.contains('locked')) {
            return;
        }
        openCard(card, day);
    });

    return card;
}

function openCard(card, day) {
    if (!card.classList.contains('flipped')) {
        card.classList.add('opening');
        setTimeout(() => card.classList.remove('opening'), 600);
    }

    card.classList.add('flipped');
    saveOpenedCard(day);

    setTimeout(() => {
        showModal(day);
        updateCountdown();
    }, 450);
}

// Modal handling
function showModal(day) {
    const modal = document.getElementById('modal');
    const modalBody = document.getElementById('modalBody');

    const content = adventContent[day];

    if (content) {
        let html = `<h2 id="modalTitle">${content.title}</h2>`;

        if (content.description) {
            html += `<p class="content-description">${content.description}</p>`;
        }

        if (content.type === 'youtube' && content.videoId) {
            html += `
                <div class="modal-video">
                    <iframe 
                        src="https://www.youtube.com/embed/${content.videoId}" 
                        title="Day ${day} reveal" 
                        frameborder="0" 
                        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                        allowfullscreen>
                    </iframe>
                </div>
            `;
        } else if (content.type === 'pdf' && content.fileUrl) {
            html += `
                <div class="modal-pdf">
                    <a href="${content.fileUrl}" class="pdf-link" target="_blank" rel="noopener">Download PDF</a>
                    <iframe src="${content.fileUrl}" class="pdf-embed" title="Day ${day} PDF"></iframe>
                </div>
            `;
        } else if (content.content) {
            html += `<div>${content.content}</div>`;
        } else {
            html += `<p>A special reveal awaits.</p>`;
        }

        modalBody.innerHTML = html;
    } else {
        modalBody.innerHTML = `
            <h2 id="modalTitle">Day ${day}</h2>
            <p>A mystery awaits. Check back soon.</p>
        `;
    }

    modal.classList.add('active');
    document.body.style.overflow = 'hidden';

    if (day === 25) {
        footerMessage.textContent = 'Merry Christmas, from the Mag!';
        countdownContainer.style.display = 'none';
    }
}

function closeModal() {
    const modal = document.getElementById('modal');
    modal.classList.remove('active');
    document.body.style.overflow = '';
}

window.closeModal = closeModal;

function initializeModal() {
    const modalClose = document.getElementById('modalClose');
    const modal = document.getElementById('modal');

    modalClose.addEventListener('click', closeModal);
    modal.addEventListener('click', (event) => {
        if (event.target === modal) {
            closeModal();
        }
    });

    document.addEventListener('keydown', (event) => {
        if (event.key === 'Escape' && modal.classList.contains('active')) {
            closeModal();
        }
    });
}

